---
description: Supabase conventions (clients, local project, migrations, typegen)
globs:
  - "packages/supabase/**/*"
  - "apps/**/src/**/*supabase*"
alwaysApply: false
---
# Supabase Conventions

## Where things live

- Local Supabase project: `packages/supabase/supabase/`
- Declarative schema (source-of-truth): `packages/supabase/supabase/schemas/`
- Migrations (generated output): `packages/supabase/supabase/migrations/`
- Generated DB types: `packages/supabase/src/types/db.ts` (generated by `bun generate`)
- Next.js clients/middleware:
  - `packages/supabase/src/clients/client.ts`
  - `packages/supabase/src/clients/server.ts`
  - `packages/supabase/src/clients/middleware.ts`

## Rules

- Don’t hand-edit generated type files; regenerate via `bun generate`.
- Prefer importing Supabase helpers from `@plop/supabase/*` instead of re-creating clients ad-hoc in apps.
- Keep cookie/session logic in the shared middleware helper to avoid auth drift between apps.

## Schema workflow (like shocking-energy)

- **Write schema changes in** `packages/supabase/supabase/schemas/*.sql` (executed in lexicographic order).
- **Do not** make hand edits directly inside `packages/supabase/supabase/migrations/` unless you’re fixing an already-shipped migration.
- After applying your schema changes locally, generate a migration:
  - `bun run --cwd packages/supabase migration:create -- -f <migration_name>`
- Commit both:
  - the updated `schemas/*.sql` file(s)
  - the generated `migrations/*.sql` file
